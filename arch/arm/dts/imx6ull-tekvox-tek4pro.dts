// SPDX-License-Identifier: GPL-2.0-or-later OR MIT
/*
 * Copyright (C) 2023 TEKVOX, Inc.
 * Author(s): James Autry <jautry@tekvox.com>
 *	      Giulio Benetti <giulio.benetti@benettiengineering.com>
 */
/dts-v1/;

#include "imx6ull.dtsi"

/ {
	model = "TEKVOX TEK4";
	compatible = "fsl,imx6ull";

	chosen {
		stdout-path = &uart6;
	};

	memory {
		reg = <0x80000000 0x20000000>;
	};

	outputs {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_outputs>, <&pinctrl_led>,
			    <&pinctrl_relays>;

		odout1 {
			label = "odout1";
			gpios = <&gpio3 2 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		odout2 {
			label = "odout2";
			gpios = <&gpio3 3 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		occtrm {
			label = "occtrm";
			gpios = <&gpio4 26 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		relay1 {
			label = "relay1";
			gpios = <&gpio4 23 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		relay2 {
			label = "relay2";
			gpios = <&gpio4 24 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		user-led {
			label = "user-led";
			gpios = <&gpio1 9 GPIO_ACTIVE_LOW>;
			default-state = "off";
		};
	};

	pwm-leds {
		compatible = "pwm-leds";

		led-1 {
			label = "sec-led1";
			max-brightness = <255>;
			pwms = <&pwm4 0 50000 0>;
		};

		led-2 {
			label = "sec-led2";
			max-brightness = <255>;
			pwms = <&pwm1 0 50000 0>;
		};

		ir_out1 {
			label = "ir-out1";
			max-brightness = <255>;
			pwms = <&pwm7 0 50000 0>;
		};

		ir_out2 {
			label = "ir-out2";
			max-brightness = <255>;
			pwms = <&pwm8 0 50000 0>;
		};
	};

	reg_dcdc_3v3: regulator-3v3 {
		compatible = "regulator-fixed";
		regulator-name = "dcdc_3v3";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
		vin-supply = <&reg_dcdc_5v>;
	};

	reg_dcdc_5v: regulator-5v {
		compatible = "regulator-fixed";
		regulator-name = "dcdc_5v";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		regulator-always-on;
		regulator-boot-on;
	};

	sound {
		compatible = "simple-audio-card";
		simple-audio-card,name = "mx6ul-ssm2604";
		simple-audio-card,format = "i2s";
		simple-audio-card,bitclock-master = <&dailink_master>;
		simple-audio-card,frame-master = <&dailink_master>;
		simple-audio-card,widgets =
			"Line", "Line In",
			"Line", "Line Out";

		simple-audio-card,cpu {
			sound-dai = <&sai2>;
		};

		dailink_master: simple-audio-card,codec {
			sound-dai = <&codec>;
			clocks = <&clks IMX6UL_CLK_SAI2>;
		};
	};

	ucom {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_ucom>;

		rs485-rs232 {
			label = "rs485-rs232";
			gpios = <&gpio3 0 GPIO_ACTIVE_HIGH>;
			default-state = "on";
		};

		en-term {
			label = "en-term";
			gpios = <&gpio4 27 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		speed {
			label = "speed";
			gpios = <&gpio4 28 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		485-rxen {
			label = "485-rxen";
			gpios = <&gpio4 25 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		com-en {
			label = "com-en";
			gpios = <&gpio3 1 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};
	};

	wdt-reboot {
		compatible = "wdt-reboot";
		wdt = <&wdog1>;
	};
};

&clks {
	assigned-clocks = <&clks IMX6UL_CLK_PLL4_AUDIO_DIV>;
	assigned-clock-rates = <786432000>;
};

&i2c1 {
	clock_frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_i2c1>;
	status = "okay";

	codec: ssm2604@1a {
		#sound-dai-cells = <0>;
		compatible = "adi,ssm2604";
		reg = <0x1a>;
	};

	pcf85063: rtc@51 {
		compatible = "nxp,pcf85063";
		reg = <0x51>;
		quartz-load-femtofarads = <12500>;

		clock {
			compatible = "fixed-clock";
			#clock-cells = <0>;
			clock-frequency = <32768>;
		};
	};
};

&fec1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_enet1>, <&pinctrl_enet1_phyrst>,
		    <&pinctrl_enet1_refclk>, <&pinctrl_enet1_int>;
	phy-mode = "rmii";
	phy-handle = <&ethphy0>;
	phy-supply = <&reg_dcdc_3v3>;
	phy-reset-gpios = <&gpio4 13 GPIO_ACTIVE_LOW>;
	phy-reset-duration = <1>;
	phy-reset-post-delay = <1>;
	status = "okay";
};

&fec2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_enet2>, <&pinctrl_enet2_phyrst>,
		    <&pinctrl_enet2_refclk>, <&pinctrl_enet2_int>,
		    <&pinctrl_enet2_mdio>;
	phy-mode = "rmii";
	phy-handle = <&ethphy1>;
	phy-supply = <&reg_dcdc_3v3>;
	phy-reset-gpios = <&gpio4 14 GPIO_ACTIVE_LOW>;
	phy-reset-duration = <1>;
	phy-reset-post-delay = <1>;
	status = "okay";

	mdio {
		#address-cells = <1>;
		#size-cells = <0>;

		ethphy0: ethernet-phy@2 {
			compatible = "ethernet-phy-id0040.61e0";
			reg = <2>;
			interrupts-extended = <&gpio4 21 IRQ_TYPE_EDGE_FALLING>;
		};

		ethphy1: ethernet-phy@1 {
			compatible = "ethernet-phy-id0040.61e0";
			reg = <1>;
			interrupts-extended = <&gpio4 22 IRQ_TYPE_EDGE_FALLING>;
		};
	};
};

&pwm1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_pwm1>;
	status = "okay";
};

&pwm4 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_pwm4>;
	status = "okay";
};

&pwm7 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_pwm7>;
	status = "okay";
};

&pwm8 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_pwm8>;
	status = "okay";
};

&sai2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_sai2>;
	assigned-clocks = <&clks IMX6UL_CLK_SAI2_SEL>,
			  <&clks IMX6UL_CLK_SAI2>;
	assigned-clock-parents = <&clks IMX6UL_CLK_PLL4_AUDIO_DIV>;
	assigned-clock-rates = <0>, <12288000>;
	fsl,sai-mclk-direction-output;
	status = "okay";
};

&snvs_poweroff {
	status = "okay";
};

&uart1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart1>;
	status = "okay";
};

&uart2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart2>;
	status = "okay";
};

&uart3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart3>;
	status = "okay";
};

&uart4 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart4>;
	status = "okay";
};

&uart5 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart5>;
	status = "okay";
};

&uart6 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart6>;
	status = "okay";
};

&uart7 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart7>;
	status = "okay";
};

&usbotg1 {
	vbus-supply = <&reg_dcdc_5v>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usb_otg1>;
	dr_mode = "otg";
	over-current-active-low;
	status = "okay";
};

&usdhc2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usdhc2>;
	vmmc-supply = <&reg_dcdc_3v3>;

	max-frequency = <52000000>;
	bus-width = <8>;
	non-removable;
	no-1-8-v;
	keep-power-in-suspend;
	wakeup-source;
	status = "okay";
};

&wdog1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_wdog>;
	fsl,ext-reset-output;
};

&iomuxc {
	pinctrl_enet1: enet1grp {
		fsl,pins = <
			MX6UL_PAD_ENET1_TX_DATA0__ENET1_TDATA00	0x1b0b0
			MX6UL_PAD_ENET1_TX_DATA1__ENET1_TDATA01	0x1b0b0
			MX6UL_PAD_ENET1_TX_EN__ENET1_TX_EN	0x1b0b0
			MX6UL_PAD_ENET1_RX_DATA0__ENET1_RDATA00	0x1b0b0
			MX6UL_PAD_ENET1_RX_DATA1__ENET1_RDATA01	0x1b0b0
			MX6UL_PAD_ENET1_RX_ER__ENET1_RX_ER	0x1b0b0
			MX6UL_PAD_ENET1_RX_EN__ENET1_RX_EN	0x1b0b0
		>;
	};

	pinctrl_enet1_int: enet1intgrp {
		fsl,pins = <
			MX6UL_PAD_CSI_DATA00__GPIO4_IO21	0x1b0b1
		>;
	};

	pinctrl_enet1_phyrst: enet1phyrstgrp {
		fsl,pins = <
			MX6UL_PAD_NAND_CE0_B__GPIO4_IO13	0x1b0b1
		>;
	};

	pinctrl_enet1_refclk: enet1refclkgrp {
		fsl,pins = <
			/* REFCLK with external 50Mhz Oscillator */
			MX6UL_PAD_ENET1_TX_CLK__ENET1_REF_CLK1	0x4001b0b1
		>;
	};

	pinctrl_enet2: enet2grp {
		fsl,pins = <
			MX6UL_PAD_ENET2_TX_DATA0__ENET2_TDATA00	0x1b0b0
			MX6UL_PAD_ENET2_TX_DATA1__ENET2_TDATA01	0x1b0b0
			MX6UL_PAD_ENET2_TX_EN__ENET2_TX_EN	0x1b0b0
			MX6UL_PAD_ENET2_RX_DATA0__ENET2_RDATA00	0x1b0b0
			MX6UL_PAD_ENET2_RX_DATA1__ENET2_RDATA01	0x1b0b0
			MX6UL_PAD_ENET2_RX_ER__ENET2_RX_ER	0x1b0b0
			MX6UL_PAD_ENET2_RX_EN__ENET2_RX_EN	0x1b0b0
		>;
	};

	pinctrl_enet2_int: enet2intgrp {
		fsl,pins = <
			MX6UL_PAD_CSI_DATA01__GPIO4_IO22	0x1b0b1
		>;
	};

	pinctrl_enet2_mdio: enet2mdiogrp {
		fsl,pins = <
			MX6UL_PAD_GPIO1_IO06__ENET2_MDIO	0x1b0b0
			MX6UL_PAD_GPIO1_IO07__ENET2_MDC		0x1b0b0
		>;
	};

	pinctrl_enet2_phyrst: enet2phyrstgrp {
		fsl,pins = <
			MX6UL_PAD_NAND_CE1_B__GPIO4_IO14	0x1b0b1
		>;
	};

	pinctrl_enet2_refclk: enet2refclkgrp {
		fsl,pins = <
			/* REFCLK with external 50Mhz Oscillator */
			MX6UL_PAD_ENET2_TX_CLK__ENET2_REF_CLK2	0x4001b0b1
		>;
	};

	pinctrl_inputs: inputsgrp {
		fsl,pins = <
			MX6UL_PAD_UART1_RTS_B__GPIO1_IO19	0x4001b0b0
			MX6UL_PAD_UART2_CTS_B__GPIO1_IO22	0x4001b0b0
			MX6UL_PAD_UART2_RTS_B__GPIO1_IO23	0x4001b0b0
			MX6UL_PAD_UART3_CTS_B__GPIO1_IO26	0x4001b0b0
			MX6UL_PAD_UART3_RTS_B__GPIO1_IO27	0x4001b0b0
		>;
	};

	pinctrl_i2c1: i2c1grp {
		fsl,pins = <
			MX6UL_PAD_GPIO1_IO02__I2C1_SCL		0x4001b8b0
			MX6UL_PAD_GPIO1_IO03__I2C1_SDA		0x4001b8b0
		>;
	};

	pinctrl_led: ledgrp {
		fsl,pins = <
			MX6UL_PAD_GPIO1_IO09__GPIO1_IO09	0x1b0b0
		>;
	};

	pinctrl_outputs: outputsgrp {
		fsl,pins = <
			MX6UL_PAD_LCD_HSYNC__GPIO3_IO02		0x190b0
			MX6UL_PAD_LCD_VSYNC__GPIO3_IO03		0x190b0
			MX6UL_PAD_CSI_DATA05__GPIO4_IO26	0x190b0
		>;
	};

	pinctrl_pwm1: pwm1grp {
		fsl,pins = <
			MX6UL_PAD_GPIO1_IO08__PWM1_OUT		0x190b0
		>;
	};

	pinctrl_pwm4: pwm4grp {
		fsl,pins = <
			MX6UL_PAD_GPIO1_IO05__PWM4_OUT		0x190b0
		>;
	};

	pinctrl_pwm7: pwm7grp {
		fsl,pins = <
			MX6UL_PAD_CSI_VSYNC__PWM7_OUT		0x190b0
		>;
	};

	pinctrl_pwm8: pwm8grp {
		fsl,pins = <
			MX6UL_PAD_CSI_HSYNC__PWM8_OUT		0x190b0
		>;
	};

	pinctrl_relays: relaysgrp {
		fsl,pins = <
			MX6UL_PAD_CSI_DATA02__GPIO4_IO23	0x190b0
			MX6UL_PAD_CSI_DATA03__GPIO4_IO24	0x190b0
		>;
	};

	pinctrl_sai2: sai2grp {
		fsl,pins = <
			MX6UL_PAD_SD1_CLK__SAI2_MCLK		0x17088
			MX6UL_PAD_SD1_CMD__SAI2_RX_SYNC		0x17088
			MX6UL_PAD_SD1_DATA1__SAI2_TX_BCLK	0x17088
			MX6UL_PAD_SD1_DATA0__SAI2_TX_SYNC	0x17088
			MX6UL_PAD_SD1_DATA3__SAI2_TX_DATA	0x11088
			MX6UL_PAD_SD1_DATA2__SAI2_RX_DATA	0x11088
		>;
	};

	pinctrl_uart1: uart1grp {
		fsl,pins = <
			MX6UL_PAD_UART1_TX_DATA__UART1_DCE_TX	0x1b0b1
			MX6UL_PAD_UART1_RX_DATA__UART1_DCE_RX	0x1b0b1
		>;
	};

	pinctrl_uart2: uart2grp {
		fsl,pins = <
			MX6UL_PAD_UART2_TX_DATA__UART2_DCE_TX	0x1b0b1
			MX6UL_PAD_UART2_RX_DATA__UART2_DCE_RX	0x1b0b1
		>;
	};

	pinctrl_uart3: uart3grp {
		fsl,pins = <
			MX6UL_PAD_UART3_TX_DATA__UART3_DCE_TX	0x1b0b1
			MX6UL_PAD_UART3_RX_DATA__UART3_DCE_RX	0x1b0b1
		>;
	};

	pinctrl_uart4: uart4grp {
		fsl,pins = <
			MX6UL_PAD_UART4_TX_DATA__UART4_DCE_TX	0x1b0b1
			MX6UL_PAD_UART4_RX_DATA__UART4_DCE_RX	0x1b0b1
		>;
	};

	pinctrl_uart5: uart5grp {
		fsl,pins = <
			MX6UL_PAD_UART5_TX_DATA__UART5_DCE_TX	0x1b0b1
			MX6UL_PAD_UART5_RX_DATA__UART5_DCE_RX	0x1b0b1
		>;
	};

	pinctrl_uart6: uart6grp {
		fsl,pins = <
			MX6UL_PAD_CSI_MCLK__UART6_DCE_TX	0x1b0b1
			MX6UL_PAD_CSI_PIXCLK__UART6_DCE_RX	0x1b0b1
		>;
	};

	pinctrl_uart7: uart7grp {
		fsl,pins = <
			MX6UL_PAD_LCD_DATA16__UART7_DCE_TX	0x1b0b1
			MX6UL_PAD_LCD_DATA17__UART7_DCE_RX	0x1b0b1
		>;
	};

	pinctrl_ucom: ucomgrp {
		fsl,pins = <
			MX6UL_PAD_LCD_CLK__GPIO3_IO00		0x190b0
			MX6UL_PAD_CSI_DATA06__GPIO4_IO27	0x190b0
			MX6UL_PAD_CSI_DATA07__GPIO4_IO28	0x190b0
			MX6UL_PAD_CSI_DATA04__GPIO4_IO25	0x190b0
			MX6UL_PAD_LCD_ENABLE__GPIO3_IO01	0x190b0
		>;
	};

	pinctrl_usb_otg1: usbotg1grp {
		fsl,pins = <
			MX6UL_PAD_GPIO1_IO00__ANATOP_OTG1_ID	0x17059
			MX6UL_PAD_GPIO1_IO01__USB_OTG1_OC	0x1b0b0
			MX6UL_PAD_GPIO1_IO04__USB_OTG1_PWR	0x1b099
		>;
	};

	pinctrl_usdhc2: usdhc2grp {
		fsl,pins = <
			MX6UL_PAD_NAND_ALE__USDHC2_RESET_B	0x1b059
			MX6UL_PAD_NAND_RE_B__USDHC2_CLK		0x10069
			MX6UL_PAD_NAND_WE_B__USDHC2_CMD		0x17059
			MX6UL_PAD_NAND_DATA00__USDHC2_DATA0	0x17059
			MX6UL_PAD_NAND_DATA01__USDHC2_DATA1	0x17059
			MX6UL_PAD_NAND_DATA02__USDHC2_DATA2	0x17059
			MX6UL_PAD_NAND_DATA03__USDHC2_DATA3	0x17059
			MX6UL_PAD_NAND_DATA04__USDHC2_DATA4	0x17059
			MX6UL_PAD_NAND_DATA05__USDHC2_DATA5	0x17059
			MX6UL_PAD_NAND_DATA06__USDHC2_DATA6	0x17059
			MX6UL_PAD_NAND_DATA07__USDHC2_DATA7	0x17059
		>;
	};

	pinctrl_wdog: wdoggrp {
		fsl,pins = <
			MX6UL_PAD_LCD_RESET__WDOG1_WDOG_ANY	0x30b0
		>;
	};
};
